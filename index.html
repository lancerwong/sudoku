<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<title>NAS Personal Data Protection System :: Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- Custom Theme files -->
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all">
<link href="css/popuo-box.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- //Custom Theme files -->
<!-- web font -->
<!--<link href="//fonts.googleapis.com/css?family=Oswald:400,700" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">-->
<style>
body::after {
  content: "";
  background: url(http://www.itbriefcase.net/wp-content/uploads/2018/04/cloud-security.jpg)no-repeat 0;
  background-size: cover;
  opacity: 0.5;
  top: 0;
  left: 0;
  bottom: -200px;
  right: 0;
  position: absolute;
  z-index: -1;   
}

h1 {
    color: black;
    background: aliceblue;
    display: block;
    width: 672px;
    border-radius: 10px;
    margin: 35px auto;
    text-transform: none;
    font-size: 28px;
    padding: 10px;
}

#btn_reg_store {
	background: #fff;
    color: #000;
    outline: none;
    display: block;
    margin: 0 auto;
    border: none;
    cursor: pointer;
    padding: 9px 38px;
    font-size: 14px;
    margin-top: 55px;
    font-weight: bold;
    text-transform: uppercase;
    font-family: 'Open Sans', sans-serif;
    transition: 0.3s all;
    -webkit-transition: 0.3s all;
}
#btn_reg_store:hover{
    background: #df5799;
	color:#ffffff;
	transition: 0.3s all;
    -webkit-transition: 0.3s all;
    -moz-transition: 0.3s all;
    -o-transition: 0.3s all;
    -ms-transition: 0.3s all;
}
/* Nav Meu Container */
#nav-menu-container {
	margin: 0;
	float: right;
	margin-right: 25px;
}

/* Nav Meu Styling */
.nav-menu a {
  padding: 0 10px 0px 8px;
  text-decoration: none;
  display: inline-block;
  color: #fff;
  font-weight: 400;
  font-size: 13px;
  text-transform: uppercase;
  outline: none;
}

.nav-menu > li {
	margin-left: 10px;
	float: left;
}

.nav-menu ul {
  margin: 22px 0 0 0;
  padding: 10px;
  box-shadow: 0px 0px 30px rgba(127, 137, 161, 0.25);
  background: #fff;
}

.nav-menu ul li {
  transition: 0.3s;
}

.nav-menu ul li a {
  padding: 10px;
  color: #333;
  transition: 0.3s;
  display: block;
  font-size: 12px;
  text-transform: none;
}

.nav-menu ul li:hover > a {
  color: #8a90ff;
}

.nav-menu ul ul {
  margin: 0;
}

</style>
<!-- //web font -->
</head>
<body>
<header id="header-subpage">
	<div class="container main-menu">
		<div class="row align-items-center justify-content-between d-flex">
			<div id="logo" style="padding: 10px;">
				<!--<a href="/"><img src="/img/logo.png" alt="" title=""></a>-->
			</div>
			<nav id="nav-menu-container">
				<ul class="nav-menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
					<li class="menu-active"><a href="index.html">Home</a></li>
					<li><a href="pdf/how_to_use.pdf" rel="no-follow" target="_blank">How To Use?</a></li>
					<li><a href="faq.html">FAQ</a></li>
					<li><a href="vision_mission.html">Vision & Missions</a></li>
					<li><a href="credits.html">Credits</a></li>
				</ul>
			</nav>
		</div>
	</div>
</header>
<h1>NAS Personal Data Protection System</h1>
<div class="main-agileits">
<!--form-stars-here-->
		<div class="form-w3-agile">
			<h2>NAS PDPS Access Portal</h2>
			<form id="frm_retrieve" action="#" method="post">
				<div class="result_failed" style="display:none; color: white; text-transform: none; text-align: center; margin-bottom: 20px; font-size: 20px; background: #ff0033; padding: 12px;">
					Failed to query your NAS PDPS Data.
				</div>					
				<div class="result_success" style="display: none; color: white; background: #4cbe83 ; text-transform: none; text-align: center; padding: 10px; font-size: 20px; margin-bottom: 20px;">Success Storing your personal data</div> 
				<div class="processing" style="display: none; color: black; background: aliceblue; text-transform: none; text-align: center; padding: 10px; font-size: 20px; margin-bottom: 20px; ">Processing your request now....</div>
				<div class="form-sub-w3">
					<input type="text" id="txt_login_email" name="email" placeholder="Email address " required="" />
				<div class="icon-w3">
					<i class="fa fa-user" aria-hidden="true"></i>
				</div>
				</div>
				<div class="form-sub-w3">
					<input type="password" id="txt_login_pwd" name="pwd" placeholder="Password" required="" />
				<div class="icon-w3">
					<i class="fa fa-unlock-alt" aria-hidden="true"></i>
				</div>
				</div>
				<p class="p-bottom-w3ls">Are you new to NAS PDPS?<a class="w3_play_icon1" href="#small-dialog1">  Secure your data here</a></p>
				
				<div class="submit-w3l">
					<input id="btn_retrieve" type="submit" value="Login">
				</div>
			</form>
		</div>
<!--//form-ends-here-->
</div>

<div class="form-w3-agile pdps-data" style="margin: 0 auto; width: 70%; color: white; padding-top: 40px; display: none;">
	<div class="contact-w3-agileits">
		<h2>Your Personal NAS PDPS Data</h2>
		<div class="form-sub-w3ls">
			<label style="float: left; padding-left: 10px; width: 50%;">Email</label>
			<label id="lbl_email" style="float: left; text-transform: none; width: 48%;"></label>
		</div>
		<div class="form-sub-w3ls" style="clear: both;">
			<label style="float: left; padding-left: 10px; width: 50%;">Full Name</label>
			<label id="lbl_name" style="float: left; text-transform: none; width: 48%;"></label>
		</div>														
		<div class="form-sub-w3ls" style="clear: both;">
			<label style="float: left; padding-left: 10px; width: 50%;">Mobile Phone No</label>
			<label id="lbl_mobile_phone" style="float: left; text-transform: none; width: 48%;"></label>
		</div>												
		<div class="form-sub-w3ls" style="clear: both;">
			<label style="float: left; padding-left: 10px; width: 50%;">National Identity Number</label>
			<label id="lbl_nric" style="float: left; text-transform: none; width: 48%;"></label>
		</div>							
		<div class="form-sub-w3ls" style="clear: both;">
			<label style="float: left; padding-left: 10px; width: 50%;">Address</label>
			<label id="lbl_address" style="float: left; text-transform: none; width: 48%;"></label>
		</div>	
		<div style="clear: both; text-align: center; margin-top: 50px; text-transform: none;">Want to query again? Click <a style="color: white; font-weight: bold;" id="btn_retrieve_again" href="#">HERE</a>
	</div>
</div>
<div id="small-dialog1" class="mfp-hide">
	<div class="contact-form1">
		<div class="contact-w3-agileits">
			<h3 style="font-size: 18px;">NAS PDPS Data Secure & Store Station</h3>								
				<form id="frm_store" action="#" method="post">
					<div class="store_failed" style="display:none; color: white; text-transform: none; text-align: left; margin-bottom: 20px; font-size: 20px; background: #ff0033; padding: 12px;"></div>	
					<div class="store_processing" style="display: none; color: black; background: aliceblue; text-transform: none; text-align: center; padding: 10px; font-size: 20px; margin-bottom: 20px; ">Processing your storing request now....</div>		
					<div class="form-sub-w3ls">
						<input id="txt_email" placeholder="Email" class="mail" type="email" required="">
						<div class="icon-agile">
							<i class="fa fa-envelope-o" aria-hidden="true"></i>
						</div>
					</div>
					<div class="form-sub-w3ls">
						<input id="txt_password" placeholder="Password"  type="password" required="">
						<div class="icon-agile">
							<i class="fa fa-unlock-alt" aria-hidden="true"></i>
						</div>
					</div>
					<div class="form-sub-w3ls">
						<input id="txt_confirm_password" placeholder="Confirm Password"  type="password" required="">
						<div class="icon-agile">
							<i class="fa fa-unlock-alt" aria-hidden="true"></i>
						</div>
					</div>
					<h2 style="color: white; margin-bottom: 20px;">Optional field for data storage</h2>
					<div class="form-sub-w3ls">
						<label style="float: left; padding-left: 10px;">Full Name</label>
						<input id="txt_name" placeholder="Your full name"  type="text">
					</div>														
					<div class="form-sub-w3ls">
						<label style="float: left; padding-left: 10px;">Mobile Phone No</label>
						<input id="txt_mobile" placeholder="Your mobile phone no"  type="text">
					</div>												
					<div class="form-sub-w3ls">
						<label style="float: left; padding-left: 10px;">National Identity Number</label>
						<input id="txt_nric" placeholder="Your Identity Card No."  type="text">
					</div>							
					<div class="form-sub-w3ls">
						<label style="float: left; padding-left: 10px;">Address</label>
						<input id="txt_address" placeholder="Your full address"  type="text">
					</div>	

				<!--<div class="login-check">
				 <label class="checkbox"><input type="checkbox" name="checkbox" checked=""><p>I Accept Terms & Conditions</p></label>
				</div>-->
					<div class="submit-w3l">
						<button id="btn_reg_store">Store</button>
					</div>
				</form>
			</div>	
		</div>
	</div>
</div>
<!-- copyright -->
	<div class="copyright w3-agile">
		<p> © 2018 NAS PDPS System. All rights reserved | Design by <a href="http://w3layouts.com/" target="_blank">W3layouts</a></p>
	</div>
	<!-- //copyright --> 
	<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
	<!--<script src=lib/bootstrap-4.0.0-dist/js/bootstrap.min.js></script>-->
	<!-- Nebulas SDK related script -->
	<script src="lib/nebPay.js"></script>	
	<script src="lib/nebulas.js"></script>	
	<!-- //Nebulas SDK related script -->
	<!-- pop-up-box -->  
	<script src="js/jquery.magnific-popup.js" type="text/javascript"></script>
	<!--//pop-up-box -->
	<script>
		"use strict";
		var magnificPopup;
		// Testnet contract address
		//var dappAddress = "n1jDzqzQRDfoSUNAqwNXgSvrWAJptzEh3dX";
		// Mainnet contract address
		var dappAddress = "n1fthL2Bu6oX3636Noz1kayZ7DzQpSHQ3RC";
		//here we use neb.js to call the "get" function to search from the Dictionary
		var nebulas = require("nebulas"),
			Account = nebulas.Account,
			neb = new nebulas.Neb();
		//neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));		
		neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"));		
		
		$("#btn_retrieve").click(function(e){
			// $("#search_value").val() 搜索框内的值
			e.preventDefault();
			var from = Account.NewAccount().getAddressString();
			var value = "0";
			var nonce = "0"
			var gas_price = "1000000"
			var gas_limit = "2000000"
			var callFunction = "get";
			var key = "salt" + $("#txt_login_email").val() + $("#txt_login_pwd").val();
			var callArgs = JSON.stringify([key]);
			var contract = {
				"function": callFunction,
				"args": callArgs
			}
			$(".result_success").hide();
			$(".result_failed").hide();
			$(".processing").show();
			neb.api.call(from,dappAddress,value,nonce,gas_price,gas_limit,contract).then(function (resp) {
				queryPDPSData(resp)
			}).catch(function (err) {
				//cbSearch(err)
				console.log("error:" + err.message)
			})
		})
		
		$("#btn_retrieve_again").click(function(e) {
			e.preventDefault();
			$(".pdps-data").hide();
			$(".main-agileits").show();	
			$("#frm_retrieve")[0].reset();
		});
		
		function queryPDPSData(resp) {
			var result = resp.result    ////resp is an object, resp.result is a JSON string
			console.log("return of rpc call: " + JSON.stringify(result))
			var resultString = JSON.stringify(result);
			$(".processing").hide();
			if(resultString.search("key") !== -1){
				result = JSON.parse(result);
				$(".pdps-data").show();
				$(".main-agileits").hide();
				$("#lbl_email").text(result.email);
				$("#lbl_name").text(result.full_name);
				$("#lbl_mobile_phone").text(result.mobile_no);
				$("#lbl_nric").text(result.nric);
				$("#lbl_address").text(result.address);
				<!-- $(".add_banner").addClass("hide"); -->
				<!-- $(".result_faile").addClass("hide"); -->
				<!-- $("#search_banner").text($("#search_value").val()) -->
				<!-- $("#search_result").text(result.value) -->
				<!-- $("#search_result_author").text(result.author) -->
				<!-- $(".result_success").removeClass("hide"); -->
			}
			if(resultString.search('"null"') !== -1){	
				$(".result_failed").show();
				<!-- $(".add_banner").addClass("hide"); -->
				<!-- $(".result_success").addClass("hide"); -->
				<!-- $("#result_faile_add").text($("#search_value").val()) -->
				<!-- $(".result_faile").removeClass("hide"); -->
			}
			if(resultString.search("error") !== -1){
				<!-- $(".add_banner").addClass("hide"); -->
				<!-- $(".result_faile").addClass("hide"); -->
				<!-- $("#search_banner").text($("#search_value").val()) -->
				<!-- $("#search_result").text(result) -->
				<!-- $("#search_result_author").text("") -->
				<!-- $(".result_success").removeClass("hide"); -->
			}
		}		
	
		document.addEventListener("DOMContentLoaded", function () {
            console.log("web page loaded...")
            setTimeout(checkNebpay, 1000);
        });
		
		var callbackUrl;
        function checkNebpay() {
            console.log("check nebpay")
            try {
                var NebPay = require("nebpay");
				if("undefined" == typeof webExtensionWallet)
				{
					if (window.confirm('You dont have the Chrome web wallet extension installed to use this Dapp click Confirm to download now ')) {
						window.location.href = 'https://github.com/ChengOrangeJu/WebExtensionWallet';
					}				
				}
				else
					console.log(`nebPay installed great`);
            } catch (e) {
                console.log(e);
                if (window.confirm('You dont have the Chrome web wallet extension installed to use this Dapp click Confirm to download now ')) {
                    window.location.href = 'https://github.com/ChengOrangeJu/WebExtensionWallet';
                }
            }
        }	
		
		var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
		var nebPay = new NebPay();
		var serialNumber;
		var callbackUrl = NebPay.config.mainnetUrl;   //如果合约在主网,则使用这个
		//var callbackUrl = NebPay.config.testnetUrl; 
		//var callbackUrl = "https://testnet.nebulas.io";
		$("#btn_reg_store").click(function(e) {
			e.preventDefault();
			$(".store_processing").show();
			$(".store_failed").hide();
			var to = dappAddress;
			var value = "0";
			var callFunction = "save"
			//var callArgs = "[\"" + $("#search_value").val() + "\",\"" + $("#add_value").val() + "\"]"
			var arg1 = $("#txt_email").val(),
				arg2 = $("#txt_password").val(),
				arg3 = $("#txt_name").val(),
				arg4 = $("#txt_mobile").val(),
				arg5 = $("#txt_nric").val(),
				arg6 = $("#txt_address").val();
			var callArgs = JSON.stringify([arg1, arg2, arg3, arg4, arg5, arg6]);
			//alert(callArgs);
			serialNumber = nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
				listener: cbPush,       //设置listener, 处理交易返回信息
				callback: callbackUrl
			});
			//alert(serialNumber);

		});
		var intervalQuery;
		function funcIntervalQuery() {
			var options = {
				callback: callbackUrl
			}
			nebPay.queryPayInfo(serialNumber,options)   //search transaction result from server (result upload to server by app)
				.then(function (resp) {
					console.log("tx result: " + resp)   //resp is a JSON string
					var respObject = JSON.parse(resp);

					if(respObject.code === 0 && respObject.data.execute_error == "" && respObject.data.status == 1){
						clearInterval(intervalQuery);
						$(".result_success").show();
						$(".store_processing").hide();
						$.magnificPopup.close(); 
						$("#frm_store")[0].reset();
						//console.log("testing");
					}
					else if(respObject.code === 0 && respObject.data.status == 0)
					{
						$(".store_failed").text(respObject.data.execute_result).show();
						$(".store_processing").hide();
						clearInterval(intervalQuery);
					}
				})
				.catch(function (err) {
					console.log(err);
					
				});
		}
		function cbPush(resp) {
			console.log("response of push: " + JSON.stringify(resp))
			var respString = JSON.stringify(resp);
			if(respString.search("rejected by user") !== -1){
				clearInterval(intervalQuery)
				alert(respString)
			}else if(respString.search("txhash") !== -1){
				//alert("wait for tx result: " + resp.txhash)
			}
			intervalQuery = setInterval(function () {
				funcIntervalQuery();
			}, 3000);			
		}	
	
		$(document).ready(function() {

			magnificPopup  = $('.w3_play_icon,.w3_play_icon1,.w3_play_icon2').magnificPopup({
				type: 'inline',
				fixedContentPos: false,
				fixedBgPos: true,
				overflowY: 'auto',
				closeBtnInside: true,
				preloader: false,
				midClick: true,
				removalDelay: 300,
				mainClass: 'my-mfp-zoom-in'
			});
																		
		});
	</script>
</body>
</html>
